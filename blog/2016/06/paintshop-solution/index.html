<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><title>OS/161: Paint Shop Synchronization Problem - Blog by Meha Masum</title><link rel="manifest" href="/blog/manifest.json"><meta name="theme-color" content="#3c78d8"><meta name="application-name" content="Blog by Meha Masum"><meta name="msapplication-TileImage" content="/img/favicon.svg"><meta name="msapplication-TileColor" content="#3c78d8"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="Blog by Meha Masum"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta description="Ideas (and code) to solve OS&amp;#x2F;161 Coding Assignment Part 3: Paint shop synchronization."><meta property="og:type" content="blog"><meta property="og:title" content="OS/161: Paint Shop Synchronization Problem"><meta property="og:url" content="https://mehamasum.github.io/blog/2016/06/paintshop-solution/"><meta property="og:site_name" content="Blog by Meha Masum"><meta property="og:description" content="Ideas (and code) to solve OS&amp;#x2F;161 Coding Assignment Part 3: Paint shop synchronization."><meta property="og:locale" content="en_US"><meta property="og:image" content="https://images.unsplash.com/photo-1554757388-29a2a86ef02f?ixlib=rb-1.2.1&amp;ixid=eyJhcHBfaWQiOjEyMDd9&amp;auto=format&amp;fit=crop&amp;w=2100&amp;q=80"><meta property="article:published_time" content="2016-06-01T00:00:00.000Z"><meta property="article:author" content="Mehedi Hasan Masum"><meta property="article:tag" content="os161"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="https://images.unsplash.com/photo-1554757388-29a2a86ef02f?ixlib=rb-1.2.1&amp;ixid=eyJhcHBfaWQiOjEyMDd9&amp;auto=format&amp;fit=crop&amp;w=2100&amp;q=80"><meta property="twitter:creator" content="@mehamasum"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://mehamasum.github.io/blog/2016/06/paintshop-solution/"},"headline":"Blog by Meha Masum","image":[],"datePublished":"2016-06-01T00:00:00.000Z","author":{"@type":"Person","name":"Mehedi Hasan Masum"},"description":"Ideas (and code) to solve OS&#x2F;161 Coding Assignment Part 3: Paint shop synchronization."}</script><link rel="canonical" href="https://mehamasum.github.io/blog/2016/06/paintshop-solution/"><link rel="icon" href="/blog/img/favicon.svg"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.12.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/blog/css/default.css"><!--!--><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><script src="https://www.googletagmanager.com/gtag/js?id=UA-106861471-1" async></script><script>window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
    
        gtag('config', 'UA-106861471-1');</script><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.css"><!--!--><!--!--><meta name="generator" content="Hexo 5.2.0"></head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/blog/">Blog by @mehamasum</a></div><div class="navbar-menu"><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="About Me" href="/blog/../">About Me</a><a class="navbar-item is-hidden-tablet catalogue" title="Catalogue" href="javascript:;"><i class="fas fa-list-ul"></i></a><div class="navbar-item" id="footer-theme"><input type="checkbox" id="theme-switch"><label for="theme-switch"><i class="fas"></i></label></div></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-8-widescreen"><div class="card"><div class="card-image"><span class="image is-7by3"><img class="fill" src="https://images.unsplash.com/photo-1554757388-29a2a86ef02f?ixlib=rb-1.2.1&amp;ixid=eyJhcHBfaWQiOjEyMDd9&amp;auto=format&amp;fit=crop&amp;w=2100&amp;q=80" alt="OS/161: Paint Shop Synchronization Problem"></span></div><article class="card-content article" role="article"><div class="article-meta is-size-7 level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2016-06-01T00:00:00.000Z" title="2016-06-01T00:00:00.000Z">2016-06-01</time></span><span class="level-item"><a class="link-muted" href="/blog/categories/Academic/">Academic</a></span><span class="level-item">3 minutes read</span></div></div><h1 class="title is-3 is-size-4-mobile">OS/161: Paint Shop Synchronization Problem</h1><div class="content"><p>Problem description can be found <a target="_blank" rel="noopener" href="https://cgi.cse.unsw.edu.au/~cs3231/14s1/assignments/asst1/">here</a> (Part 3: Paint shop synchronization)</p>
<p>In this article <strong>I‚Äôm going to assume</strong>:</p>
<ul>
<li>You have already set up and run OS/161</li>
<li>You have a clear understanding how threads work</li>
<li>You already understand binary and counting semaphores, now it‚Äôs time to use them to solve this problem</li>
</ul>
<hr>
<h2 id="Main-Idea"><a href="#Main-Idea" class="headerlink" title="Main Idea"></a>Main Idea</h2><p>The basic task is to make the paint shop run properly.
This is a modified version of classic <strong>Bounded Buffer Problem</strong> and the problem is very realistic.</p>
<p>We kept two different buffers, one buffer for placing orders and another buffer for shipping the processed color cans.</p>
<p>Customers come and place their order in FIFO basis (or randomly) in the order buffer. After that they keep searching the shipment buffer for the arrival of their can having the proper color combination.</p>
<p>Staffs keep checking the order buffer for orders. After getting an order, they fill it with demanded color combination and finally place the ready can in the shipment buffer.</p>
<p>So, to summarize, here is what is going to happen:</p>
<ol>
<li>The first idea that comes to mind is that, the customers will come and put their cans in a buffer, lets call it <code>order_buffer</code>.</li>
<li>Stuffs will pick up cans from the <code>order_buffer</code> and fill with color.</li>
<li>Then they would put the can in another buffer, lets call it <code>shipment_buffer</code>.</li>
<li>Finally the customers can take back their can from <code>shipment_buffer</code>.</li>
</ol>
<h2 id="Semaphores"><a href="#Semaphores" class="headerlink" title="Semaphores"></a>Semaphores</h2><p>We have used different semaphores to make sure that:</p>
<ol>
<li>No two customer try to use the <code>order_buffer</code> at the same time</li>
<li>No two stuff try to use the <code>shipment_buffer</code> at the same time</li>
<li>Neither of the buffers gets overflowed or under-flowed</li>
</ol>
<p>This is quite an easy code to write, but the tricky part is to find out why the deadlocks happen when they happen.</p>
<p>Another issue is printing the message ‚ÄúStaff x going home after mixing y orders‚Äù. We solved it by making each stuff for fixed period of time so that we can ensure that whoever went home before him reached home by that time. Otherwise this message will be printed in all messed up fashion.</p>
<h2 id="Personal-notes-and-code"><a href="#Personal-notes-and-code" class="headerlink" title="Personal notes and code"></a>Personal notes and code</h2><p>I have seen solutions that use <code>thread_yield()</code> calls to stop threads. I personally feel that, the task is to utilize the system built semaphores, so using kernel level calls in here is not a good idea.</p>
<p>In our solution, we made the users put their empty cans in the <code>order_buffer</code> at random positions. FIFO could have been done as well, but we preferred a different approach. Besides, random is always fair üòõ</p>
<p>You may have a look at our solution on <a target="_blank" rel="noopener" href="https://github.com/mehamasum/OS161-paint-shop">github</a>. But remember, <strong>the immense joy you would feel once your paint shop runs correctly- will be missed completely</strong> if you decide to copy the code.</p>
<p>Don‚Äôt give up if you fall in deadlocks, it might take even an entire week to solve the problem!  </p>
<p>Leave your thoughts in comments. Happy coding!</p>
<script>
        document.querySelectorAll('.not-gallery-item')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script></div><div class="article-licensing box"><div class="licensing-title"><p>OS/161: Paint Shop Synchronization Problem</p><p><a href="https://mehamasum.github.io/blog/2016/06/paintshop-solution/">https://mehamasum.github.io/blog/2016/06/paintshop-solution/</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>Author</h6><p>Mehedi Hasan Masum</p></div></div><div class="level-item is-narrow"><div><h6>Posted on</h6><p>2016-06-01</p></div></div><div class="level-item is-narrow"><div><h6>Licensed under</h6><p><a class="icon" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a><a class="" rel="noopener" target="_blank" title="CC BY-NC-SA 4.0" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a></p></div></div></div></div></div><div class="article-tags is-size-7 mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/blog/tags/os161/">os161</a></div><div class="addthis_inline_share_toolbox"></div><script src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5c1d3e20a1e1ce87" defer></script></article></div><!--!--><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/blog/2019/05/first-class-functions/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">First-Class Functions - ‡¶™‡¶æ‡¶á‡¶•‡¶®‡ßá ‡¶ï‡ßç‡¶≤‡¶ø‡¶® ‡¶ï‡ßã‡¶°</span></a></div></nav><div class="card"><div class="card-content"><h3 class="title is-5">Comments</h3><div id="disqus_thread"><noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div><script>var disqus_config = function () {
            this.page.url = 'https://mehamasum.github.io/blog/2016/06/paintshop-solution/';
            this.page.identifier = 'paintshop-solution';
        };
        (function() {
            var d = document, s = d.createElement('script');  
            s.src = '//' + 'mehamasum' + '.disqus.com/embed.js';
            s.setAttribute('data-timestamp', +new Date());
            (d.head || d.body).appendChild(s);
        })();</script></div></div></div><!--!--><div class="column column-right is-4-tablet is-4-desktop is-4-widescreen  order-3 is-sticky"><div class="card widget" id="toc" data-type="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">Catalogue</h3><ul class="menu-list"><li><a class="level is-mobile" href="#Main-Idea"><span class="level-left"><span class="level-item">Main Idea</span></span></a></li><li><a class="level is-mobile" href="#Semaphores"><span class="level-left"><span class="level-item">Semaphores</span></span></a></li><li><a class="level is-mobile" href="#Personal-notes-and-code"><span class="level-left"><span class="level-item">Personal notes and code</span></span></a></li></ul></div></div><style>#toc .menu-list > li > a.is-active + .menu-list { display: block; }#toc .menu-list > li > a + .menu-list { display: none; }</style><script src="/blog/js/toc.js" defer></script></div><div class="card widget" data-type="categories"><div class="card-content"><div class="menu"><h3 class="menu-label">Categories</h3><ul class="menu-list"><li><a class="level is-mobile" href="/blog/categories/Academic/"><span class="level-start"><span class="level-item">Academic</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/blog/categories/Tutorial/"><span class="level-start"><span class="level-item">Tutorial</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></div></div></div><div class="card widget" data-type="tags"><div class="card-content"><div class="menu"><h3 class="menu-label">Tags</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/blog/tags/clean-code/"><span class="tag">clean code</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/blog/tags/os161/"><span class="tag">os161</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/blog/tags/python/"><span class="tag">python</span><span class="tag">1</span></a></div></div></div></div></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/blog/">Blog by @mehamasum</a><p class="is-size-7">¬©¬†2020 Mehedi Hasan Masum¬†‚Ä¢¬†All rights reserved</p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="StackOverflow Profile" href="https://stackoverflow.com/users/4135289/mehamasum"><i class="fab fa-stack-overflow"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="GitHub Profile" href="https://github.com/mehamasum"><i class="fab fa-github"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Connect on LinkedIn" href="https://linkedin.com/in/mehamasum"><i class="fab fa-linkedin"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" async></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/blog/js/column.js"></script><a id="back-to-top" title="Back to top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/blog/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-right",
        content: {
          message: "This website uses cookies to improve your experience.",
          dismiss: "Got it!",
          allow: "Allow cookies",
          deny: "Decline",
          link: "Learn more",
          policy: "Cookie Policy",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><!--!--><!--!--><div id="outdated"><h6>Your browser is out-of-date!</h6><p>Update your browser to view this website correctly.&amp;npsb;<a id="btnUpdateBrowser" href="http://outdatedbrowser.com/">Update my browser now </a></p><p class="last"><a href="#" id="btnCloseUpdateBrowser" title="Close">√ó</a></p></div><script src="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.js" defer></script><script>window.addEventListener("load", function () {
            outdatedBrowser({
                bgColor: '#f25648',
                color: '#ffffff',
                lowerThan: 'object-fit' // display on IE11 or below
            });
        });</script><!--!--><!--!--><script src="/blog/js/main.js" defer></script><!--!--><!-- hexo injector body_end start -->
    <script>
    (() => {
        function switchTab() {
            if (!location.hash) {
              return;
            }
            Array
                .from(document.querySelectorAll('.tab-content'))
                .forEach($tab => {
                    $tab.classList.add('is-hidden');
                });
            Array
                .from(document.querySelectorAll('.tabs li'))
                .forEach($tab => {
                    $tab.classList.remove('is-active');
                });
            const $activeTab = document.querySelector(location.hash);
            if ($activeTab) {
                $activeTab.classList.remove('is-hidden');
            }
            const $tabMenu = document.querySelector(`a[href="${location.hash}"]`);
            if ($tabMenu) {
                $tabMenu.parentElement.classList.add('is-active');
            }
        }
        switchTab();
        window.addEventListener('hashchange', switchTab, false);
    })();
    </script>
    
<script src="/blog/js/theme.js"></script>
<!-- hexo injector body_end end --></body></html>